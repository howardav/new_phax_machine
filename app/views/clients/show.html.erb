<div class="row">
	<div class="col-lg-8">
		<h1><%= @client.client_label %></h1>
	</div>
	<div class="col-lg-4 align-self-center">
		<% if is_admin? %>
			<%= link_to "Manage Client Fax Numbers / Details", edit_client_path(@client), class: "btn btn-success btn-lg" %>
		<% end %>
	</div>
</div>

<% if @client.fax_numbers.present? %>
	<% @client.fax_numbers.each do |client_fax_number| %>
		<div class="row information-box">
			<div class="col-lg-5">
				<h2>
					<% if is_admin? %>
						<%= link_to FaxNumber.format_pretty_fax_number(client_fax_number.fax_number), edit_fax_number_path(client_fax_number) %>
					<% else %>
						<%= FaxNumber.format_pretty_fax_number(client_fax_number.fax_number) %>
					<% end %>
				</h2>
				<% if is_admin? %>
					<div class="col">
						<div class="row">
							<p><strong>Admin Label: </strong><%= client_fax_number.fax_number_label %></p>
						</div>
						<div class="row">
							<p><strong>Client Label: </strong> <%= client_fax_number.fax_number_display_label %></p>
						</div>
					</div>
				<% else %>
					<div class="col">
						<div class="row">
							<p><%= client_fax_number.fax_number_display_label %></p>
						</div>
					</div>
				<% end %>

				<div class="form-group">
					<% if client_fax_number.client.user_emails.present? %>
						<%= link_to "Link / Unlink Users", edit_fax_number_user_email_path(client_fax_number), class: "btn btn-success" %>
					<% else %>
						<div class="col">
							<p><em> Add users below to start linking them to your fax numbers</em></p>
						</div>
					<% end %>
				</div>
			</div>
			
			<div class="col-lg-7 align-self-center">
				<table class="table table-hover table-striped table-sm">
					<thead class="thead-dark">
						<tr>
							<th class="text-center">Email</th>
							<th class="text-center">Caller ID</th>
						</tr>
					</thead>
					<tbody>
						<% if client_fax_number.user_emails.present? %>
							<% client_fax_number.user_emails.each do |user_email| %>
								<tr>
									<td class="text-center"><%= user_email.email_address %></td>
									<td class="text-center"><%= FaxNumber.format_pretty_fax_number(user_email.caller_id_number) %></td>
								</tr>
							<% end %>
						<% else %>
							<tr>
								<td></td>
								<td class="text-center"> None Assigned</td>
								<td></td>
							</tr>
						<% end %>
					</tbody>
				</table>
			</div>
		</div>
	<% end %>

	<br>
	<div class="container-fluid user-form">
		<h2><%= @client.client_label %> Users</h2>
		<div class="col">
			<p><em>If you would only like to implement email-to-fax capabilities and do not wish for your users to log in to send a fax, uncheck the 'Invite User' box.</em></p>
		</div>
		<div class="row">
			<div class="inline-input-margin col-lg-10">
				<%= form_for :user, url: "/users", method: :post, class: "form-inline" do |f| %>
					<%= f.hidden_field :client_id, value: "#{@client.id}" %>
					<div class="row">
						<div class="form-group col-lg-4">
							<strong><%= f.label :email, "Email:", class: "pull-left" %></strong>
							<%= f.email_field :email, class: "form-control" %>
						</div>
						<div class="form-group col-lg-4">
							<strong><%= f.label :caller_id_number, "Caller ID Number:", class: "pull-left" %></strong>
							<select class="form-control form-inline" name="user[caller_id_number]">
								<% @client.fax_numbers.each do |client_fax_number| %>
									<option name="user[caller_id_number]" value="<%= client_fax_number.fax_number %>" selected="selected">
										<%= FaxNumber.format_pretty_fax_number(client_fax_number.fax_number) %>
										<% if client_fax_number.fax_number_display_label.present? %>
									 		- <%= client_fax_number.fax_number_display_label %>
									 	<% end %>
									 </option>
								<% end %>
							</select>
						</div>
						<div class="col force-down-checkbox inline-input-margin text-center">
							<input type="checkbox" id="invite-new-user" class="form-check-input" name="user[invite]" checked="checked">
							<label for="invite-new-user" class="form-check-label">Invite User</label>
						</div>
						<div class="col form-group force-down-button">
							<%= f.submit "Create User", class: "btn btn-success" %>
						</div>
					</div>
				<% end %>
			</div>
		</div>
	</div>

	<% if @client.user_emails.present? %>
		<div class="container-fluid">
			<br>
			<div class="col">
				<p><em>Click 'Edit User' to grant an existing user to Phax Machine or to revoke their access.</em></p>
			</div>
		</div>
		<div class="row information-box">
			<div class="col-lg-6">
				<table class="table table-sm table-hover">
					<tbody>
						<% @client.user_emails.each do |user_email| %>
							<% if @client.user_emails.index(user_email).even? %>
								<tr>
									<td class="text-center"><%= user_email.email_address %></td>
									<td class="text-center">
										<%= link_to "Edit User", edit_user_email_path(id: user_email.id), class: "btn btn-sm btn-success" %>
									</td>
								</tr>
							<% end %>
						<% end %>
					</tbody>
				</table>
			</div>

			<div class="col-lg-6">
				<table class="table table-sm table-hover">
					<tbody>
						<% @client.user_emails.each do |user_email| %>
							<% if @client.user_emails.index(user_email).odd? %>
								<tr>
									<td class="text-center"><%= user_email.email_address %></td>
									<td class="text-center">
										<%= link_to "Edit User", edit_user_email_path(id: user_email.id), class: "btn btn-sm btn-success" %>
									</td>
								</tr>
							<% end %>
						<% end %>
					</tbody>
				</table>
			</div>
		</div>
	<% end %>

<% else %>
	<% if is_admin? %>
		<div class="row information-box">
			<div class="col">
				<p>No Fax Numbers are associated with this account. Please click 'Manage Client Fax Numbers / Details' above to assign a fax number to this client.</p>
			</div>
		</div>
	<% end %>
<% end %>