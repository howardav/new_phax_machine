<h1>User Guide - Admin</h1>

<div class="underline"></div>

<div id="faq" class="col readme-block">
	<h2>Frequently Asked Questions</h2>
	<p>
		<b>Why are my users receiving emails that say "You are not linked to the fax number you attempted to fax"?</b>
		<b>Why am I being alerted that users within an organization are not linked to a fax number and cannot fax?</b>
	</p>
	<p>
		<a href="#linking-unlinking-users">See Linking/Unlinking Users</a>
	</p>
</div>

<div class="underline"></div>

<div id="table-contents" class="readme-block">
	<h2>Table of Contents</h2>
	<p style="margin-bottom: -10px;">Administrator Functions:</p>
	<ul>
		<li><a href="#managing-fax-numbers">Managing Fax Numbers</a></li>
		<li><a href="#managing-organizations">Managing Organizations</a></li>
		<li><a href="#changing-logo">Changing the Logo</a></li>
		<li><a href="#admin-emails">Email Templates</a></li>
	</ul>
	<p style="margin-bottom: -10px;"><a href="#manager-intro">Manager and Administrator Functions:</a></p>
		<ul>
			<li><a href="#manager-dashboard">Manager Dashboard</a></li>
			<li><a href="#linking-unlinking-users">Linking/Unlinking Users</a></li>
			<li><a href="#managing-users">Managing Users</a></li>
		</ul>
	<p style="margin-bottom: -10px;"><a href="#fax-logs-general">Fax Logs:</a></p>
		<ul>
			<li><a href="#fax-logs-general">Fax Logs</a></li>
			<li><a href="#fax-logs-download-file">Downloading a File</a></li>
			<li><a href="#fax-logs-search">Searching</a></li>
			<li><a href="#fax-logs-limitations">Fax Log Limitations</a></li>
			<li><a href="#fax-logs-admin">Fax Logs As Administrator</a></li>
			<li><a href="#fax-logs-manager">Fax Logs As a Manager</a></li>
			<li><a href="#fax-logs-user">Fax Logs As a User</a></li>
		</ul>
	<p style="margin-bottom: -10px;">General Use:</p>
		<ul>
			<li><a href="#general-use">Fax Portal</a></li>
			<li><a href="#change-password">Changing or Reset Your Password</a></li>
		</ul>
</div>

<div class="underline"></div>

<div id="managing-fax-numbers" class="col readme-block">
	<h2>Managing Fax Numbers</h2>
	<p>
		The Fax Numbers page displays a table of all fax numbers in the Admin's Phaxio account, the organization that the fax number is linked to, an optional label, the date the fax number was provisioned, the location of the fax number(city/state/province), and whether or not the fax number has a 'callback_url' assigned to it. Fax numbers with an assigned callback_url will not work with Phax Machine. To manage callback_url's assigned to your fax numbers, head over to the <a href="https://console.phaxio.com/phone_numbers">Phone Numbers page</a> in your Phaxio account, and then reload the Fax Numbers page (in Phax Machine) when you're done editing your changes. Fax numbers with an assigned callback_url will be at the bottom of the fax numbers table. Fax numbers that already have a callback_url will be available to add to organizations, however this is not recommended as they will not be functional. In the example below, several fax numbers have already been labeled, and the bottom two numbers have a callback_url.
	</p>

	<div class="readme-image">
		<%= image_tag("faxnumberpage.png", width: 1100) %>
	</div>

	<p>
		The top of the Fax Numbers page also allows the Admin to provision a new fax number. The Area Code dropdown menu dynamically changes based on the selected State/Province in the menu to the left. Toll-Free numbers are listed as "Non-Geographic" in State/Province.
	</p>
	<p>
		If the Admin desires, they may add a label to any fax number that can only be viewed by the Admin by clicking one of the edit buttons on the right of the table. The Admin can also move the fax number into a different organization by selecting it from the dropdown menu (this will remove all user data linked to the number in its previous organization, and is not recommended), or remove the fax number from its organization.
	</p>

	<div class="readme-image">
		<%= image_tag("editfaxnumberpage.png", width: 900) %>
	</div>

</div>

<div class="underline"></div>

<div id="managing-organizations" class="col readme-block">
	<h2>Managing Organizations</h2>
	<p>
		Organizations are groups of users and fax numbers set by the Admin. To create an organization, navigate to the Organizations Page ("Organizations" on the navbar) and click the "Add New Organization" button in the top right corner of the screen.

		This page displays all fax numbers that are not assigned to a organization in the "Add fax numbers" table on the left. Please note that fax numbers with a red X next to them already have a primary callback_url will not have fax-to-email capabilities until the callback_url is removed.
	</p>

	<div class="readme-image">
		<%= image_tag("neworganization.png", width: 700) %>
	</div>

	<p>
		When creating an organization, the Admin checks the box of fax numbers they would like to assign to the organization, gives the organization a name (this name will be seen by the organization's Manager), and decides if the Manager of the organization will be allowed to purchase additional fax numbers. In this example we're creating the "Great Plains LLC" organization, adding all of the fax numbers that are already labeled, and allowing fax numbers to be purchased by the organization. Please note that if an organization is allowed to provision fax numbers, each provisioned fax number will be charged to the Admin's Phaxio account.

		Once an organization has been created, it will appear in the organization page. Each organization's fax numbers and manager (if it has one) are shown. If an organization does not have a manager, a field will be present for inviting a manager, with an additional dropdown menu of fax numbers to set as the manager's caller ID number. In this example we'll invite bob.loblaw@greatplainsllc.com to manage Great Plains LLC.
	</p>

	<div class="readme-image">
		<%= image_tag("organizationindex.png", width: 1100) %>
	</div>

	<p>
		If an admin would like to edit an organization, they can click on the organization's name, which takes them to a page displaying all of the users linked to a particular fax number. Users may be linked to multiple fax numbers or just one, depending on the use case. When a fax number receives a fax, every person linked to that number will be emailed. To edit the organization, click on the "Manage Great Plains LLC Fax Numbers/Details" in the upper right corner.
	</p>

	<div class="readme-image">
		<%= image_tag("organizationshowadmin.png", width: 1200) %>
	</div>

	<p>
		In this case we'll simultaneously remove the two fax numbers that have a callback_url, and add the fax number with the 971 area code to this organization.
	</p>

	<div class="readme-image">
		<%= image_tag("organizationedit.png", width: 900) %>
	</div>
</div>

<div class="underline"></div>

<div id="changing-logo" class="col readme-block">
	<h2>Changing the Logo</h2>
	<p>
		The Admin may change the site logo (Fast Banana Viral Marketing in this example) by clicking "Edit Profile" in the navigation menu on the left. To change the logo, simply link to the location of the desired logo, input your password, and Phax Machine will add and resize the logo appropropriately. Logos must be an image, and look best when a transparent background is used. The logo is viewed by all users of Phax Machine and is included within all emails sent from Phax Machine.
	</p>

	<div class="readme-image">
		<%= image_tag("editlogo.png", width: 1100) %>
	</div>
</div>

<div id="admin-emails" class="col readme-block">
	<h2>Email Templates</h2>
	<p style="margin-bottom: -10px">
		Phax Machine's email templates are simple and easily customized. All templates and their locations are listed below for easy customization by a developer if desired:
		<ul>
			<li>Password Reset Form --> app/views/devise/mailer/password_reset_instructions.html.erb</li>
			<li>Admin Invitation --> app/views/phax_machine_mailer/admin_welcome_invite.html.erb</li>
			<li>Manager Invitation --> app/views/phax_machine_mailer/manager_welcome_invite.html.erb</li>
			<li>User Invitation --> app/views/phax_machine_mailer/user_welcome_invite.html.erb<?
			<li>Sent/Received Fax Notification --> app/views/mailgun_mailer/fax_email.html.erb (notification of a successful/failed fax)</li>
			<li>Email-to-Fax Failure Notification --> app/views/mailgun_mailer/fax_email.html.erb (notification that Phax Machine was unable to complete email-to-fax conversion, not that a fax itself has failed)</li>
		</ul>
	</p>
</div>

<div class="underline"></div>

<div id="manager-intro" class="col readme-block">
	<h2>Manager Functions</h2>
	<p>
		Managers are invited by the Administrator via email to manage an organization. Each organization may only have one manager, or an organization can function without a manager. An organization's manager or the Administrator links users to fax numbers and assigns the users caller ID numbers. A user/manager's caller ID number will be the caller ID number used on all faxes sent out by that user, regardless of what other numbers the user is linked to. Managers should first invite users and then link them to fax numbers. Users who are not linked to a fax number by the manager will be able to log in, however <b>they will be unable to send or receive faxes by email nor will they be able to send a fax using the fax portal until they are linked to at least one fax number</b>. How to link and unlink users to a fax number is <a href="#linking-unlinking-users">described below</a>.
	</p>
</div>

<div id="manager-dashboard" class="col readme-block">
	<h2>Manager Dashboard</h2>
	<p>
		The Dashboard provides the manager with a summary of all fax numbers and their linked users. Managers link/unlink users to fax numbers by clicking on the "Link/Unlink Users" button under each fax number. A table of all users currently linked to a fax number is shown next to each fax number. Managers may also add a label to their fax numbers by clicking on the fax number and entering a label. Below is the manager's view of Great Plains LLC.
	</p>

	<div class="readme-image">
		<%= image_tag("organizationshow.png", width: 1100) %>
	</div>

	<p>
		If the manager is not allowed to provision fax numbers (default when the Administrator creates an organization), the button to provision fax numbers will not be present.
	</p>
</div>

<div class="underline"></div>

<div id="managing-users" class="col readme-block">
	<h2>Managing Users</h2>
	<p>
		Managers or the Administrator may invite users to Phax Machine and revoke user access in their Users portal. When a manager invites a user, they select one of the fax numbers within their organization from the dropdown menu. Managers may also edit an existing user's email address or caller ID number at a later time, or deactivate a user by by clicking the 'Edit' button in the user table.
	</p>

	<div class="readme-image">
		<%= image_tag("userspage.png", width: 900) %>
	</div>

	<p>
		In the above example, Saul Goodman hasn't shown his face around the office for a year and has been terminated, so his access has been revoked by the manager. Users with revoked access cannot send/receive faxes by email and cannot log in to use the portal. They will not receive a notification indicating their access has been revoked. In situations where a user is for instance transitioning into a new position and being replaced by another user, it is better to edit that user's email address and then have the user reset their password through the "Forgot Password?" link on the login screen than to revoke the account's access.
	</p>

	<p>
		The edit page for 'holly@cas.org' is shown below. If a user's email address is edited, they will not be notified of the edit via email, be sure the sure is aware their email was changed.
	</p>

	<div class="readme-image">
		<%= image_tag("edituser.png", width: 800) %>
	</div>

	<p>
		When a user's access is revoked, they're unlinked from fax numbers. This will remove them from the "received" data in fax logs. The manager will still be able to see the faxes that were sent by the revoked user in the past, but not any faxes received by the user in the past.
	</p>

	<p>
		To reactivate a user, simply re-invite them with the same email address they used previously. A user whose access has been reinstated will be sent another activation email. After reinstating access to a user, the manager will have to go back and link the reactivated user to fax numbers once again. If a user's access is revoked and then reinstated, they will be unable to view faxes they have sent and received prior to being restored. While it is possible to restore a user, it is not recommended.
	</p>
</div>

<div class="underline"></div>

<div id="linking-unlinking-users" class="readme-block col">
	<h2>Linking/Unlinking Users</h2>
	<p>
		The image below shows the blank Dashboard of the fictional Chicago Animal Shelter organization. Currently, NONE of the users are able to utilize fax-to-email and email-to-fax capabilities. Note that the tables of linked users, which displays the user's email address and caller ID number, is empty.
	</p>

	<div class="readme-image">
		<%= image_tag("managerdashnoprovnolink.png", width: 1000) %>
	</div>

	<p>
		To link users, click on the blue "Chicago Animal Shelter Users" button at the top right of the screen, and then add and remove users by checking the appropriate boxes, similarly to how fax numbers are added/removed from an organization. The Link/Unlink Users page is shown below.
	</p>

	<div class="readme-image">
		<%= image_tag("managerlinkusers.png", width: 800) %>
	</div>

	<p>
		After linking users, the Chicago Animal Shelter dashboard will now look like the image below, and its users are ready to start sending/receiving faxes.
	</p>

	<div class="readme-image">
		<%= image_tag("managernoprovlinkedusers.png", width: 1000) %>
	</div>
</div>

<div class="underline"></div>

<div id="fax-logs-general" class="col readme-block">
	<h2>Fax Logs</h2>
	<p>
		Fax Logs display different information depending on the user's permission level. All permission levels may filter faxes by status and within a time range. If the "Start Time" field is left empty, it defaults to one week ago. If the "End Time" field is left empty, it defaults to the user's system clock time. Please note that both Start Time and End Time calendars have a time that defaults to noon of the current day, which will need to be adjusted when searching by dates. Results are paginated with 20 results per page, and up to 50 pages of fax logs (1000 total) may be displayed in a given search.
	</p>
</div>

<div class="underline"></div>

<div id="fax-logs-download-file" class="col readme-block">
	<h2>Downloading Files</h2>
	<p>
		When a user clicks the download button, Phax Machine will attempt to download the fax as a PDF file if the file exists (it was converted properly and the user has not disabled storage). If the file cannot be found, the user will be notified in message at the top of the page.
	</p>

	<p>
		The Administrator may download all faxes. A manager may download all faxes that were sent or received by users within their organization. A user may only download faxes sent or received to fax numbers they're currently linked to.
	</p>
</div>

<div class="underline"></div>

<div id="fax-logs-search" class="col readme-block">
	<h2>Searching</h2>
		<p>
		When searching Fax Logs as a Manager or a generic user, the 'Start Time' is automatically limited to when the organization was created. For example, if a user registered on March 11th, 2018 and tries to search for faxes from January of 2018, Phax Machine will automatically adjust the Start Time to March 11th, 2018 silently in the background. The Administrator may search for faxes from any time range.
	</p>
</div>

<div id="fax-logs-limitations" class="col readme-block">	
	<h2>Fax Log Limitations</h2>
	<p>
		<b>Fax Logs will only sort data based on the <i>current relationships</i> between users and fax numbers.</b> The faxes previously sent by a user with revoked access still be displayed in fax logs, however the faxes received by the user will not be labeled with that user's email address. <b>Revoking a user's access removes the link between the user and the fax number</b>, and thus the removed link cannot be reported on. Reinstating access for a user will not make the link to that information "come back". 
	</p>

	<p>
		The same principle applies to deleted organizations, as an organization will delete its users and thus their relationships with the fax numbers. Deleted organizations will still appear in the Admin's Fax Logs, however only the faxes sent by the organization will appear.
	</p>

	<p>
		If a fax number is transferred from one organization to another, all linkages between its users and its previous organization are wiped out, thus it will have no fax logs from its previous life in its prior organization.
	</p>
</div>

<div class="underline"></div>

<div id="fax-logs-admin" class="col readme-block">	
	<h2>Fax Logs as an Admin</h2>
	<p>
		When the fax log page loads, the first 20 faxes within the past week are loaded (if they exist). The Administrator may search for faxes over any time period, and may search by an individual organization, an individual fax number, or a combination of the two. Clicking "All" in either the Fax Number or Organization dropdown menus will reset both menus to include everything.  Within each fax log entry, if the user can be found, Phax Machine will display the user that sent a fax and the organization the fax was sent from or the organization the fax was sent to. Unfortunately on the received end, it is not currently possible to narrow down exactly what user received a fax, as each fax number may have multiple users linked to it, and because the same caller ID number may be assigned to multiple users.
	</p>

	<div class="readme-image">
		<%= image_tag("adminfaxlogs.png", width: 1100) %>
	</div>
</div>

<div class="underline"></div>

<div id="fax-logs-manager" class="col readme-block">	
	<h2>Fax Logs as a Manager</h2>
	<p>
		Managers may only search for faxes within their organization. Managers may search by fax number, user, or a combination of both. Please note that when viewing received faxes in fax logs, if a fax number has multiple users linked to it, it will only show up once in the fax logs, not once for each user linked to the number.
	</p>

	<p style="margin-bottom: -10px;">For example, the following users are linked to the fax number with an 847 area code:
		<ul>
			<li>harvey.birdman@sebbenandsebben.com</li>
			<li>bob.loblaw@greatplainsllc.com</li>
		</ul>
	</p>

	<p>
		The 847 number received a fax on September 30th, 2018 (fax at the top of the logs). The received fax shows up only once in the fax logs. If the manager searches individually by each of the two users shown above, it will show up once for each user.
	</p>
</div>

<div class="underline"></div>

<div id="fax-logs-user" class="col readme-block">	
	<h2>Fax Logs as a User</h2>
	<p>
		Users may only search for their own faxes by individual fax number or all of the fax numbers they're linked to. If a user is unlinked from a fax number, they will be unable to search for faxes linked to that previous fax number.
	</p>
</div>

<div class="underline"></div>

<div id="general-use" class="col readme-block"> 
	<h2>Fax Portal</h2>
	<p>
		The fax portal allows users to send a fax from within Phax Machine. Simply enter the phone number you'd like to send a fax to in E.164 format (12225554444, no spaces, no dashes, no parenthesis), and attach up to twenty files. Files will be attached in the order they're uploaded. In the example below, 'firstfax.odt' will be the first file, 'secondfax.odt', the second file, and so on. Users may remove a file by clicking the red trashcan icon. A maximum of 20 files per fax may be combined into a single fax totaling 200 pages maximum. Files may be drag and dropped or uploaded by clicking the "Choose File" button. Files are numbered in the order they will appear in the final fax
	</p>

	<div class="readme-image">
		<%= image_tag("faxportal2.png", width: 800) %>
	</div>
</div>

<div class="underline"></div>

<div id="change-password" class="col readme-block"> 
	<h2>Change or Reset Your Password</h2>
	<p>
		Any user may change their password by clicking on the "Profile" link in the navigation bar on the left of the screen. Password resets and forgotten logins are handled via email using Devise. A user is required to enter their current password to change their password. If a user forgets their password, a password reset option via email is available from Phax Machine's login screen.
	</p>
</div>

<div class="underline" style="margin-bottom:300px;"></div>
